<html>
   <head>
      <title>Simple Snap Example</title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <!-- <link rel="stylesheet" href="/static/checkout.css"> -->
      <script type="text/javascript"
            src="https://app.sandbox.midtrans.com/snap/snap.js"
            data-client-key="<%= clientKey %>"></script>
   </head>
   <body>
    <div class='cart'>
      <input type='hidden' id='snap_token' value="<%= token %>"/>
      <input type='hidden' id='email' value="<%= email %>"/>
      <input type='hidden' id='jumlah' value="<%= jumlah %>"/>
      <input type='hidden' id='password' value="<%= password %>"/>
      <div class='popup'>
        <div class='row header'>
          <span>Top Up</span>
          <span>Saldo</span><br>
          <span>Email Pengguna : <%=email %></span>
        </div>

        <div class='row items'>
          <span>Jumlah Saldo Yang Ingin Ditambahkan : </span>
          <span><%=jumlah %></span>
        </div>
        <div class='row checkout'>
          <span><a href='#'></a></span>
          <button class='checkout-button'>Checkout</button>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script>
      function TambahSaldo(){
          let params = {
              "email" : $("#email").val(),
              "password" : $("#password").val(),
              "jumlah" : $("#jumlah").val()
          };
          $.ajax({
              url : "http://localhost:3000/217116590/Tambah_Saldo",
              method : "POST",
              data : params,
              success : function(data){
                console.log("SUCCESS Update Database");
              }
          });
      }
      //pilih cara pembayaran dan midtrans
      var token = document.querySelectorAll('#snap_token')[0].value;

      var checkoutBtn = document.querySelectorAll('.checkout')[0];
      checkoutBtn.onclick = function(){
        console.log('opening snap popup:');
        snap.pay(token, {
          // Optional
          onSuccess: function(result){
            TambahSaldo();
          },
          // Optional
          onPending: function(result){
            TambahSaldo();
          },
          // Optional
          onError: function(result){
            TambahSaldo();
          }
        });
      }
    </script>
   </body>
</html>
